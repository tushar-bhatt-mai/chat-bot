(()=>{const e=document.getElementById("chat-box"),t=document.getElementById("user-input"),n="https://dev-maibot-predictionapi.p2eppl.com/";let a={};const s=function(e){const t=window.location.href.split("?")[1],n=new URLSearchParams(t);return Object.fromEntries(n.entries())}();let o=s?.token,r=s?.refreshToken;var c=!1;function d(){(e=>{const t=e?.display_name.split(" ").map((e=>e[0])).join(""),n=document.getElementById("roundedName");var a=document.createElement("img");a.src=`${e?.profile_picture_url}`,a.classList.add("imgStyle"),"NA"!==e?.profile_picture_url?n.appendChild(a):e?.display_name?(n.style.backgroundColor="#6D1874",n.innerHTML=`${t}`):n.style.backgroundColor="transparen"})(a);const e=document.getElementById("chat-Navbar");a?.background_colour?e.style.backgroundColor=a?.background_colour:e.classList.add("bgColor");document.getElementById("display-chat").innerHTML=a?.display_name?"Chat With":"",document.getElementById("display-name").innerHTML=`${a?.display_name?a?.display_name:""}`;const t=document.getElementById("initialValue");t.innerHTML=`<span class='bot-message'>${a?.initial_message?a?.initial_message:"Initial Message"}</span>`,t.style.fontSize=a?.font_size||"12px",t.style.fontFamily=a?.font_style||"Arial, sans-serif",function(e){const t=document.getElementById("suggested-messages");t.innerHTML="",e.forEach((e=>{const n=document.createElement("button");n.textContent=e,n.classList.add("suggestion-button"),n.onclick=function(){!function(e){document.getElementById("user-input").value=e,l();document.getElementById("suggested-messages").style.display="none"}(e)},t.appendChild(n)}))}(a?.suggested_messages||[])}function l(){const e=t.value.trim();if(!e)return;i(e,"user",!1),t.value="";const a=new Headers;a.append("Authorization",`Bearer ${o}`);const r=new FormData;r.append("username",s.username),r.append("modelname",s.modelname),r.append("question",e),r.append("source_language_code","en"),c=!0,fetch(n,{method:"POST",headers:a,body:r,redirect:"follow"}).then((e=>e.text())).then((e=>{var t=JSON.parse(e||"{}");console.log("parse result"),401==t.StatusCode?(m(),i("Something went Wrong, Please try again","bot",!0)):(JSON.stringify(e),i(JSON.parse(e)?.message,"bot",!0),c=!1)})).catch((e=>{console.error("error",e)})).finally((()=>{c=!1}))}function i(t,n,a){const s=document.createElement("div");s.classList.add("user"===n?"user-messageDev":"bot-messageDev");const o=document.createElement("span");if(o.classList.add("user"===n?"user-message":"bot-message"),c&&a&&"bot"===n){const e=document.createElement("div");e.className="loader";for(let t=0;t<3;t++){const t=document.createElement("span");e.appendChild(t)}o.appendChild(e),setTimeout((()=>{e.style.display="none",o.textContent=t}),1e3)}else o.textContent=t;var r;c=!1,s.appendChild(o),e.appendChild(s),(r=document.getElementById("chat-box"))&&(r.scrollTop=r.scrollHeight)}!function(){const e=new Headers;e.append("Authorization",`Bearer ${o}`);const t=new FormData;t.append("username",s.username),t.append("chatbot_name",s.chatbotname),fetch("https://dev-maibot-chatbot-detailapi.p2eppl.com/get_chatbot_customization",{method:"POST",headers:e,body:t,redirect:"follow"}).then((e=>e.text())).then((e=>{const t=JSON.parse(e);200===t.statusCode&&(a=t.message,d())})).catch((e=>console.error("error",e)))}();const m=async()=>{try{const e=await fetch("https://dev-auth2api.p2eppl.com/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:r})}),t=await e.json();t?.result&&(o=t?.result?.access_token,l())}catch(e){console.error(e)}}})();